# Сервис генерации числового мультипликатора

HTTP-сервис для генерации случайных мультипликаторов с настраиваемым RTP (Return to Player).

## Описание

Сервис генерирует случайные числовые мультипликаторы в диапазоне [1.0, 10000.0] таким образом, чтобы при обработке последовательности чисел клиентом достигался заданный RTP.

## Запуск

```bash
go run . -rtp=0.8
```

Параметры:
- `-rtp` - значение RTP в диапазоне (0, 1.0] (по умолчанию: 1.0)

## API

### GET /get

Возвращает сгенерированный мультипликатор в формате JSON.

**Запрос:**
```
GET http://localhost:64333/get
```

**Ответ:**
```json
{
  "result": 2.5
}
```

## Алгоритм работы

### 1. Принцип работы

Сервис использует вероятностный алгоритм для достижения целевого RTP:

- **С вероятностью RTP**: генерирует мультипликатор > 1.0 (выигрышный)
- **С вероятностью (1-RTP)**: генерирует мультипликатор ≤ 1.0 (проигрышный)

### 2. Логика клиента

Клиент обрабатывает последовательность чисел по правилам:

```
Если multiplier > x: x остается неизменным
Если multiplier ≤ x: x становится 0
```

### 3. Расчет RTP

```
RTP = sum1 / sum0
```

Где:
- `sum0` - количество элементов в последовательности
- `sum1` - сумма элементов после обработки

## Математическое обоснование

### Цель алгоритма

Достичь соотношения `RTP = sum1/sum0 ≈ заданное_значение_rtp`

### Реализация

1. **Выигрышный путь** (вероятность = RTP):
   - Генерируем `multiplier ∈ [1.0, 10000.0]`
   - Для любого `x ∈ [1.0, 10000.0]` будет `multiplier > x`
   - Следовательно, `x` остается неизменным

2. **Проигрышный путь** (вероятность = 1-RTP):
   - Генерируем `multiplier ∈ [0.0, 1.0]`
   - Для любого `x ≥ 1.0` будет `multiplier ≤ x`
   - Следовательно, `x` становится 0

### Результат

При большом количестве запросов (>10,000) доля выживших элементов стремится к заданному RTP.

## Пример работы

### Входные данные:
```
Последовательность: [2.0, 3.0, 100.0, 1.1, 1.1]
RTP = 0.8 (80% элементов должны выжить)
```

### Генерация мультипликаторов:
```
2.0 → multiplier = 1.5 → 1.5 ≤ 2.0 → становится 0
3.0 → multiplier = 500 → 500 > 3.0 → остается 3.0
100.0 → multiplier = 0.8 → 0.8 ≤ 100.0 → становится 0
1.1 → multiplier = 2.0 → 2.0 > 1.1 → остается 1.1
1.1 → multiplier = 1.5 → 1.5 > 1.1 → остается 1.1
```

### Результат:
```
Итоговая последовательность: [0, 3.0, 0, 1.1, 1.1]
sum0 = 5 (количество элементов)
sum1 = 0 + 3.0 + 0 + 1.1 + 1.1 = 5.2
RTP = 5.2 / 5 = 1.04
```

## Технические детали

- **Порт**: 64333
- **Протокол**: HTTP
- **Формат ответа**: JSON
- **Генератор случайных чисел**: `math/rand` 
- **Потокобезопасность**: Использование отдельного экземпляра `rand.Rand`

## Требования

- Go 1.20+
- Порт 64333 должен быть свободен

## Алгоритм генерации мультипликатора

```go
func generateMultiplier(rtp float64) float64 {
    randomValue := rng.Float64()
    
    if randomValue < rtp {
        // Выигрышный путь: multiplier ∈ [1.0, 10000.0]
        return 1.0 + rng.Float64()*(maxMultiplier-1.0)
    } else {
        // Проигрышный путь: multiplier ∈ [0.0, 1.0]
        return rng.Float64() * 1.0
    }
}
```

## Объяснение выбора границ

### Граница 1.0 - критическая точка:
- **multiplier = 1.0**: для x = 1.0 → 1.0 ≤ 1.0 → x становится 0 ❌
- **multiplier = 1.0001**: для x = 1.0 → 1.0001 > 1.0 → x остается 1.0 ✅

### Граница 10000.0 - максимальное покрытие:
- Покрывает все возможные x ∈ [1.0, 10000.0]
- Гарантирует `multiplier > x` для любого x

## Проверка корректности

При RTP = 0.8 и большом количестве запросов (>10,000):
- Ожидается, что ~80% мультипликаторов будут > 1.0
- Ожидается, что ~20% мультипликаторов будут ≤ 1.0
- Итоговый RTP клиента должен стремиться к 0.8
```

